<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Praveen Puglia</title>
  <link rel="icon" href="/favicon.ico?v=3a7b593d67fc9446c6e65fd7bb65b1d6" type="image/png">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png?v=af793840ab76d327059988eee0b29e32">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png?v=02966a86860c609548bed8f9e7de52af">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png?v=cbed115daa5ba82d4bf58c5117e2b533">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png?v=5559c1648649bd07ab067566dda9ec42">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png?v=4f26c8a923dc1bbef9af2949d5f990fc">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png?v=4fa45a5650a605cc004968c0f0da9a31">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png?v=d7aa79cbf5ba31cb2cb152d8857f5fa4">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png?v=17cbced9d3588c1c28c77e643c17c4b9">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png?v=980b496335bd05ccd855a62ec85f7bf6">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png?v=9ed36a9188bf498d32b8e4513b0075e0">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=25c339606b2b086d26ef332c6dced6b0">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png?v=2ae569596707e8f205e98373e6f775a4">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=6d383be39308b8025d869abd56607680">
  <link rel="manifest" href="/manifest.webmanifest?v=1374cda5b6cea46d0a648c713dd097b2">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <link href="https://unpkg.com/prism-themes@1.6.0/themes/prism-dracula.css" rel="stylesheet">
  <link href="/css/style.css?v=aa5002caa516b2109061a4201ff69aab" rel="stylesheet">
  
  









<title>Adding a secret page for developers with app version &amp; commit hash in a Vite.js / React app - Praveen Puglia</title>



<meta property="og:site_name" content="Praveen Puglia"/>
<meta property="og:title" content="Adding a secret page for developers with app version &amp; commit hash in a Vite.js / React app - Praveen Puglia"/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://praveenpuglia.com/blog/secret-page-dev-info-vite-react/"/>
<meta property="twitter:url" content="https://praveenpuglia.com/blog/secret-page-dev-info-vite-react/"/>
<meta property="twitter:site" content="Praveen Puglia"/>


  <meta name="twitter:creator" content="@praveenpuglia"/>


<meta name="description" content="Praveen Puglia"/>
<meta name="twitter:description" content="Praveen Puglia"/>
<meta property="og:description" content="Praveen Puglia"/>


  <meta property="og:image" content="https://praveenpuglia.com/home-banner.webp"/>
  <meta name="twitter:image" content="https://praveenpuglia.com/home-banner.webp"/>



<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Readex+Pro:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">

</head>
  <body>
    <div class="container">
      <header class="main-header">
  <a href="/">
    <h3 class="main-header-logo">Hi! I am Praveen</h3>
  </a>
  <nav aria-role="navigation" class="main-navigation">
    <ul class="navigation-links">
      <li class="navigation-link-item">
        <a class="navigation-link" href="/blog">Blog</a>
      </li>
      <li class="navigation-link-item navigation-link-item--social">
        <a target="_blank" class="navigation-link" href="https://linkedin.com/in/praveenpuglia">
          <img src="https://cdn.svgporn.com/logos/linkedin-icon.svg" alt="CodePen Logo">
        </a>
      </li>
      <li class="navigation-link-item navigation-link-item--social">
        <a target="_blank" class="navigation-link" href="https://github.com/praveenpuglia">
          <img src="https://cdn.svgporn.com/logos/github-icon.svg" alt="CodePen Logo">
        </a>
      </li>
      <li class="navigation-link-item navigation-link-item--social">
        <a target="_blank" class="navigation-link" href="https://codepen.io/praveenpuglia">
          <img src="https://cdn.svgporn.com/logos/codepen-icon.svg" alt="CodePen Logo">
        </a>
      </li>
      <li class="navigation-link-item navigation-link-item--social">
        <a target="_blank" class="navigation-link" href="https://twitter.com/praveenpuglia">
          <img src="https://cdn.svgporn.com/logos/twitter.svg" alt="CodePen Logo">
        </a>
      </li>
    </ul>
  </nav>
</header>
      <article class="post">
  <h1>Adding a secret page for developers with app version &amp; commit hash in a Vite.js / React app</h1>
  <p><img src="../assets/images/2023/app-version-git-hash.png" alt="Adding a secret page for developers with app version &amp; commit hash in a Vite.js / React app"></p>
<p>I love bare bones health pages / system info pages which give you critical information about your application in the fastest possible way. The app version &amp; the hash of the currently deployed code are two of those critical things.</p>
<p>I recently added this to a <a href="https://vitejs.dev/">Vite.js</a> / <a href="https://reactjs.org/">React</a> app but the same can be done for any Vite based app. Here's what I did.</p>
<h2>Creating Global Constants</h2>
<p>Vite allows us to create global constants via <code>vite.config.ts</code>'s <code>define</code> section.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  define<span class="token operator">:</span> <span class="token punctuation">{</span><br>    __APP_VERSION__<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>    __COMMIT_HASH__<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>More about <code>define</code> <a href="https://vitejs.dev/config/shared-options.html#define">here</a>.</p>
<p>To make TypeScript aware of these global constants, I needed to define them in <code>vite-env.d.ts</code> file. I could also create an <code>env.d.ts</code> file and define them there as prescribed in the Vite docs.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">declare</span> <span class="token keyword">const</span> __APP_VERSION__<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br><span class="token keyword">declare</span> <span class="token keyword">const</span> __COMMIT_HASH__<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></code></pre>
<h2>Getting App Version</h2>
<p>Now that I had the global constants ready to use, I needed to find a way to get the app's current version. Usually, this comes from the <code>version</code> field in <code>package.json</code> so I picked it up from there.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// vite.config.ts</span><br><br><span class="token keyword">import</span> packageConfig <span class="token keyword">from</span> <span class="token string">"./package.json"</span><span class="token punctuation">;</span><br><br>packageConfig<span class="token punctuation">.</span>version<span class="token punctuation">;</span> <span class="token comment">// "1.0.0"</span></code></pre>
<p>While doing this, I also got a TypeScript error telling me I can't import a JSON file here. For that to work, I had to modify <strong>tsconfig.node.json</strong></p>
<ul>
<li>add <code>&quot;resolveJsonModule&quot;: true</code> in <code>compilerOptions</code></li>
<li>add <code>&quot;package.json&quot;</code> in <code>include</code> array.</li>
</ul>
<p>That did the trick.</p>
<h2>Getting the Commit Hash</h2>
<pre class="language-ts"><code class="language-ts"><span class="token comment">//vite.config.ts</span><br><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> child <span class="token keyword">from</span> <span class="token string">"child_process"</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> commitHash <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">execSync</span><span class="token punctuation">(</span><span class="token string">"git rev-parse --short HEAD"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2>Updating Global Constants</h2>
<p>I initially just assigned the <code>packageConfig.version</code> and <code>commitHash</code> values directly to the constants in define like this.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  define<span class="token operator">:</span> <span class="token punctuation">{</span><br>    __APP_VERSION__<span class="token operator">:</span> packageConfig<span class="token punctuation">.</span>version<span class="token punctuation">,</span><br>    __COMMIT_HASH__<span class="token operator">:</span> commitHash<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This broke the build because these values weren't interpreted as strings. Reading the documentation for <code>define</code> revealed that the values are interpreted as raw expressions. In order to use the values as strings, I had to stringify them using <code>JSON.stringify()</code>.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  define<span class="token operator">:</span> <span class="token punctuation">{</span><br>    __APP_VERSION__<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>packageConfig<span class="token punctuation">.</span>version<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    __COMMIT_HASH__<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>commitHash<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2>Creating the Secret Page</h2>
<p>This was as simple as creating a route entry for a path like <code>__dev__</code> and rendering a simple component with the global constants.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// Router.tsx => Uses React Router 6.</span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>__dev__<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DevInfo</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span></code></pre>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// DevInfo.tsx</span><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">DevInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">></span></span><span class="token plain-text"><br>      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>__APP_VERSION__<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span><span class="token plain-text"> at </span><span class="token punctuation">{</span>__COMMIT_HASH__<span class="token punctuation">}</span><span class="token plain-text"><br>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">></span></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>That's all. Now I can go to <code>/__dev__</code> route and access this information for any deployment of my app.</p>

</article>
    </div>
  </body>
</html>